var __reflect=this&&this.__reflect||function(t,e,r){t.__class__=e,r?r.push(e):r=[e],t.__types__=t.__types__?r.concat(t.__types__):r},__extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},DefaultPortrait=function(t){function e(e,r,i,n,o){var a=this,s="defaultPortrait_"+e+"_jpg";return a=t.call(this,RES.getRes(s))||this,a.x=r,a.y=i,a.width=n,a.height=o,a.name=e+"",a}return __extends(e,t),e}(egret.Bitmap);__reflect(DefaultPortrait.prototype,"DefaultPortrait");var Socket=function(){function t(){}return t.init=function(t,e){this.webSocket=new egret.WebSocket,this.webSocket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveData,this),this.webSocket.addEventListener(egret.Event.CONNECT,this.onConnected,this),this.webSocket.addEventListener(egret.Event.CLOSE,this.onConnectClose,this),this.webSocket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onIOError,this),this.webSocket.connect(t,e)},t.register=function(t){if(this.socketReceiveList.some(function(e){return t.key==e.key}))throw"key is exist";this.socketReceiveList.push(t)},t.writeOff=function(t){for(var e=0;e<=this.socketReceiveList.length;e++){var r=this.socketReceiveList[e];if(r.key==t){this.socketReceiveList.splice(e,1);break}}},t.send=function(t){this.webSocket.writeUTF(JSON.stringify(t))},t.onReceiveData=function(t){var e=this.webSocket.readUTF();if(0!=e.length)for(var r=JSON.parse(e),i=0,n=this.socketReceiveList;i<n.length;i++){var o=n[i];o.key==r.key&&o.receive(r.code,r.data)}},t.onConnected=function(){console.log("webSocket","connect success")},t.onConnectClose=function(){console.log("webSocket","connect closed")},t.onIOError=function(){console.log("webSocket","IO Error")},t}();Socket.socketReceiveList=[],__reflect(Socket.prototype,"Socket");var PlayerButtonContainer=function(t){function e(e,r){var i=t.call(this)||this,n=RES.getRes("layout_json").playerButtonContainer;return i.x=n.x,i.y=n.y,i.width=n.width,i.height=n.height,i.show(e,r),i}return __extends(e,t),e.prototype.show=function(t,e){if(0==e){var r=new Button("pass",250,0,200,80);r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,t.buttonBuJiao,t),this.addChild(r);var i=new TextTip("不叫",286,6,64);this.addChild(i);var n=new Button("ok",550,0,200,80);n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,t.buttonJiaoDiZhu,t),this.addChild(n);var o=new TextTip("叫地主",554,6,64);this.addChild(o)}else if(1==e){var r=new Button("pass",250,0,200,80);r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,t.buttonBuQiang,t),this.addChild(r);var i=new TextTip("不抢",286,6,64);this.addChild(i);var n=new Button("ok",550,0,200,80);n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,t.buttonQiangDiZhu,t),this.addChild(n);var o=new TextTip("抢地主",554,6,64);this.addChild(o)}else if(2==e){var a=new Button("pass",100,0,200,80);a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,t.buttonBuYao,t),this.addChild(a);var s=new TextTip("不要",136,6,64);this.addChild(s);var r=new Button("pass",400,0,200,80);r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,t.buttonTiShi,t),this.addChild(r);var i=new TextTip("提示",436,6,64);this.addChild(i);var n=new Button("ok",700,0,200,80);n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,t.buttonChuPai,t),this.addChild(n);var o=new TextTip("出牌",736,6,64);this.addChild(o)}},e}(egret.DisplayObjectContainer);__reflect(PlayerButtonContainer.prototype,"PlayerButtonContainer");var PortraitOtherContainer=function(t){function e(e,r,i,n){var o=t.call(this)||this,a=RES.getRes("layout_json").portraitOtherContainer;i?o.x=a.leftX:o.x=a.rightX,o.y=a.y,o.width=a.width,o.height=a.height;var s=new egret.Shape;s.graphics.beginFill(1122867),s.graphics.drawRect(0,0,o.width,o.height),s.graphics.endFill(),s.alpha=.5,o.addChild(s);var h=new TextTip(e,0,100,32);if(h.width=100,o.addChild(h),n){var l=new TextTip("地主",100,0,32);l.width=100,o.addChild(l)}return o.show(r),o}return __extends(e,t),e.prototype.show=function(t){var e=new DefaultPortrait(t,0,0,100,100);this.addChild(e)},e}(egret.DisplayObjectContainer);__reflect(PortraitOtherContainer.prototype,"PortraitOtherContainer");var PukerBottomContainer=function(t){function e(e){var r=t.call(this)||this,i=RES.getRes("layout_json").pukerBottomContainer;r.x=i.x,r.y=i.y,r.width=i.width,r.height=i.height;var n=new egret.Shape;return n.graphics.beginFill(1122867),n.graphics.drawRect(0,0,r.width,r.height),n.graphics.endFill(),n.alpha=.5,r.addChild(n),r.show(e),r}return __extends(e,t),e.prototype.show=function(t){for(var e=RES.getRes("layout_json").puker,r=0,i=0;i<t.length;i++){var n=new Puker(t[i],r+i*e.pukerXSSpace,0,e.pukerXSWidth,e.pukerXSHeight);this.addChild(n)}},e}(egret.DisplayObjectContainer);__reflect(PukerBottomContainer.prototype,"PukerBottomContainer");var PukerContainer=function(t){function e(e,r){var i=t.call(this)||this,n=RES.getRes("layout_json").pukerContainer;i.x=n.x,i.y=n.y,i.width=n.width,i.height=n.height;var o=new egret.Shape;return o.graphics.beginFill(1122867),o.graphics.drawRect(0,0,i.width,i.height),o.graphics.endFill(),o.alpha=.3,i.addChild(o),i.show(e,r),i}return __extends(e,t),e.prototype.show=function(t,e){for(var r=RES.getRes("layout_json").puker,i=.5*(20-e.length)*r.pukerSpace,n=0;n<e.length;n++){var o=new Puker(e[n],i+n*r.pukerSpace,r.pukerUpMove,r.pukerWidth,r.pukerHeight);o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,t.pukerClick,t),this.addChild(o)}},e.prototype.removePukerByNames=function(t){for(var e=0;e<t.length;e++)null!=this.getChildByName(t[e]+"")&&this.removeChild(this.getChildByName(t[e]+""))},e}(egret.DisplayObjectContainer);__reflect(PukerContainer.prototype,"PukerContainer");var PukerOtherContainer=function(t){function e(e,r){var i=t.call(this)||this,n=RES.getRes("layout_json").pukerOtherContainer;r?i.x=n.leftX:i.x=n.rightX,i.y=n.y,i.width=n.width,i.height=n.height;var o=new egret.Shape;return o.graphics.beginFill(1122867),o.graphics.drawRect(0,0,i.width,i.height),o.graphics.endFill(),o.alpha=.5,i.addChild(o),i.show(e,r),i}return __extends(e,t),e.prototype.show=function(t,e){var r=RES.getRes("layout_json").puker,i=0;e||(i=(20-t.length)*r.pukerSmallSpace);for(var n=0;n<t.length;n++){var o=new Puker(t[n],i+n*r.pukerSmallSpace,0,r.pukerSmallWidth,r.pukerSmallHeight);this.addChild(o)}},e}(egret.DisplayObjectContainer);__reflect(PukerOtherContainer.prototype,"PukerOtherContainer");var PukerPlayContainer=function(t){function e(e){var r=t.call(this)||this,i=RES.getRes("layout_json").pukerPlayerContainer;r.x=i.x,r.y=i.y,r.width=i.width,r.height=i.height;var n=new egret.Shape;return n.graphics.beginFill(1127253),n.graphics.drawRect(0,0,r.width,r.height),n.graphics.endFill(),n.alpha=.3,r.addChild(n),r.show(e),r}return __extends(e,t),e.prototype.show=function(t){for(var e=RES.getRes("layout_json").puker,r=.5*(20-t.length)*e.pukerSpace,i=0;i<t.length;i++){var n=new Puker(t[i],r+i*e.pukerSpace,0,e.pukerWidth,e.pukerHeight);this.addChild(n)}},e}(egret.DisplayObjectContainer);__reflect(PukerPlayContainer.prototype,"PukerPlayContainer");var PukerVerticalContainer=function(t){function e(e,r){var i=t.call(this)||this,n=RES.getRes("layout_json").pukerVerticalContainer;r?i.x=n.leftX:i.x=n.rightX,i.y=n.y,i.width=n.width,i.height=n.height;var o=new egret.Shape;return o.graphics.beginFill(1122969),o.graphics.drawRect(0,0,i.width,i.height),o.graphics.endFill(),o.alpha=.5,i.addChild(o),i.show(e),i}return __extends(e,t),e.prototype.show=function(t){for(var e=RES.getRes("layout_json").puker,r=0,i=0,n=0;n<t.length;n++){n>=10&&(r=.3*e.pukerSmallHeight),i>=10&&(i-=10);var o=new Puker(t[n],r,i*e.pukerSmallSpace,e.pukerSmallWidth,e.pukerSmallHeight);i++,this.addChild(o)}},e}(egret.DisplayObjectContainer);__reflect(PukerVerticalContainer.prototype,"PukerVerticalContainer");var SpiderContainer=function(t){function e(e,r){var i=t.call(this)||this;i.layout=RES.getRes("layout_json").layout,i.x=0,i.y=100,i.width=900,i.height=400;var n=new egret.Shape;return n.graphics.beginFill(7833753),n.graphics.drawRect(0,0,i.width,i.height),n.graphics.endFill(),n.alpha=.3,i.addChild(n),i.show(e,r),i}return __extends(e,t),e.prototype.show=function(t,e){for(var r=0;r<t.length;r++){var i=new Puker(t[r],e+(r+1)*this.layout.pukerBigSpace,20,this.layout.pukerBigWidth,this.layout.pukerBigHeight);i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.pukerStartMove,this),i.addEventListener(egret.TouchEvent.TOUCH_END,this.pukerStopMove,this),this.addChild(i)}},e.prototype.pukerStartMove=function(e){this.draggedObject=e.currentTarget,this.offsetX=e.stageX-this.draggedObject.x,this.offsetY=e.stageY-this.draggedObject.y,this.addChild(this.draggedObject),console.log("dd:",t.prototype.getChildIndex.call(this,this.draggedObject)),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.pukerMove,this)},e.prototype.pukerMove=function(t){this.draggedObject.x=t.stageX-this.offsetX,this.draggedObject.y=t.stageY-this.offsetY},e.prototype.pukerStopMove=function(t){console.log("pukerClick: y:",this.draggedObject.y,this.draggedObject.name),this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.pukerMove,this)},e}(egret.DisplayObjectContainer);__reflect(SpiderContainer.prototype,"SpiderContainer");var TextOtherContainer=function(t){function e(e,r){var i=t.call(this)||this,n=RES.getRes("layout_json").textOtherContainer;return r?i.x=n.leftX:i.x=n.rightX,i.y=n.y,i.width=n.width,i.height=n.height,i.show(e,r),i}return __extends(e,t),e.prototype.show=function(t,e){var r=0;e||(r=16+64*(6-t.length));var i=new TextTip(t,r,0,64);this.addChild(i)},e}(egret.DisplayObjectContainer);__reflect(TextOtherContainer.prototype,"TextOtherContainer");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.randomNames=["大可","Tiger","翔","傻源源","傻乐乐","小巴西","油烟机","绿萝","薄荷","油麦菜","糖拌西红柿","酸辣土豆丝","可乐鸡翅","拍黄瓜","油炸花生米","猫砂不会盖","风扇不摇头","电视不能看","空调没有遥控器","这么晚了还不回家","程咬金","忽必烈"],e.key="hall",e.isConnectioned=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.receive=function(t,e){if(console.log("收到服务器数据--code:",t,"data",e),"10000"===t){console.log("已连接到服务器");var r=this.randomNames[Math.floor(Math.random()*this.randomNames.length)];Socket.send({key:"hall",code:"10000",data:{name:r}}),console.log("已发送用户信息，name:",r),this.isConnectioned=!0}else"10001"===t&&(console.log("已分配房间"),this.intoRoom(e.seat,e.gamers))},e.prototype.createGameScene=function(){var t=RES.getRes("layout_json").layout;this.stage.setContentSize(t.stageWidth,t.stageHeight),console.log("舞台大小：",this.stage.stageWidth,"*",this.stage.stageHeight);var e=new PlayerP2C;this.addChild(e)},e.prototype.startGame=function(t){return this.isConnectioned?(Socket.send({key:"hall",code:"10001"}),void console.log("已向Server请求开始游戏，等待Server分配房间...")):void console.log("服务端未连接")},e.prototype.intoRoom=function(t,e){null!=this.getChildByName("button")&&this.removeChild(this.getChildByName("button")),null!=this.getChildByName("text")&&this.removeChild(this.getChildByName("text"));var r=new PlayerP2P_Single(t,e);this.addChild(r)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,r=RES.getRes(t);return e.texture=r,e},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main",["SocketReceive"]);var Button=function(t){function e(e,r,i,n,o){var a=this,s="button_"+e+"_png";a=t.call(this,RES.getRes(s))||this,a.x=r,a.y=i,a.width=n,a.height=o,a.name=e+r;var h=new egret.Rectangle(60,30,80,20);return a.scale9Grid=h,a}return __extends(e,t),e}(egret.Bitmap);__reflect(Button.prototype,"Button");var Layout=function(t){function e(e,r){var i=t.call(this,RES.getRes("bg_jpg"))||this;return i.width=e,i.height=r,i.alpha=.3,i}return __extends(e,t),e}(egret.Bitmap);__reflect(Layout.prototype,"Layout");var Puker=function(t){function e(e,r,i,n,o){var a=this,s=e+"_jpg";return a=t.call(this,RES.getRes(s))||this,a.x=r,a.y=i,a.width=n,a.height=o,a.name=e+"",a}return __extends(e,t),e}(egret.Bitmap);__reflect(Puker.prototype,"Puker");var TextTip=function(t){function e(e,r,i,n){var o=t.call(this)||this;return o.x=r,o.y=i,o.textColor=16777215,o.size=n,o.fontFamily="KaiTi",o.textAlign=egret.HorizontalAlign.CENTER,o.text=e,o}return __extends(e,t),e}(egret.TextField);__reflect(TextTip.prototype,"TextTip");var PlayerP2C=function(t){function e(){var e=t.call(this)||this;e.pukerSelectArray=new Array,e.index=0,e.mySeat=1,e.landlordSeat=1,e.playingSeat=1,e.pukerUtil=new PukerUtils,e.pukers=e.pukerUtil.init(),e.pukers1=e.pukers.slice(0,17).sort(PukerUtils.sortDESC),e.pukers2=e.pukers.slice(17,34).sort(PukerUtils.sortDESC),e.pukers3=e.pukers.slice(34,51).sort(PukerUtils.sortDESC),e.pukers4=e.pukers.slice(51).sort(PukerUtils.sortDESC),e.layout=RES.getRes("layout_json").layout;var r=new Layout(e.layout.stageWidth,e.layout.stageHeight);return e.addChild(r),e.show(),e}return __extends(e,t),e.prototype.show=function(){this.puker=new PukerContainer(this,this.pukers1),this.puker.name="puker",this.addChild(this.puker),this.pukerVerticalRight=new PukerVerticalContainer(this.pukers2,!1),this.pukerVerticalRight.name="pukerVerticalRight",this.addChild(this.pukerVerticalRight),this.pukerVerticalLeft=new PukerVerticalContainer(this.pukers3,!0),this.pukerVerticalLeft.name="pukerVerticalLeft",this.addChild(this.pukerVerticalLeft),this.pukerBottom=new PukerBottomContainer(this.pukers4),this.pukerBottom.name="pukerBottom",this.addChild(this.pukerBottom),this.buttons=new PlayerButtonContainer(this,0),this.buttons.name="buttons",this.addChild(this.buttons),this.portraitLeft=new PortraitOtherContainer("小明",1,!0,!1),this.portraitLeft.name="portraitLeft",this.addChild(this.portraitLeft),this.portraitRight=new PortraitOtherContainer("小红",2,!1,!1),this.portraitRight.name="portraitRight",this.addChild(this.portraitRight)},e.prototype.buttonChuPai=function(t){console.log("ButtonOkClick--自己的牌:",this.pukers1.toString()),console.log("ButtonOkClick--要出的牌:",this.pukerSelectArray.toString()),this.pukers1=PukerUtils.removeElements(this.pukers1,this.pukerSelectArray),console.log("ButtonOkClick--出过后的牌:",this.pukers1.toString()),null!=this.getChildByName("puker")&&this.removeChild(this.getChildByName("puker")),this.puker=new PukerContainer(this,this.pukers1),this.puker.name="puker",this.addChild(this.puker),null!=this.getChildByName("pukerPlay")&&this.removeChild(this.getChildByName("pukerPlay")),this.pukerPlay=new PukerPlayContainer(this.pukerSelectArray.sort(PukerUtils.sortDESC)),this.pukerPlay.name="pukerPlay",this.addChild(this.pukerPlay),this.pukerSelectArray=new Array},e.prototype.buttonBuJiao=function(t){console.log("不叫"),null!=this.getChildByName("pukerVerticalRight")&&this.removeChild(this.getChildByName("pukerVerticalRight")),this.pukerVerticalRight=new PukerVerticalContainer(this.pukers2.concat(this.pukers4).sort(PukerUtils.sortDESC),!1),this.pukerVerticalRight.name="pukerVerticalRight",this.addChild(this.pukerVerticalRight),null!=this.getChildByName("portraitRight")&&this.removeChild(this.getChildByName("portraitRight")),this.portraitRight=new PortraitOtherContainer("小红",2,!1,!0),this.portraitRight.name="portraitRight",this.addChild(this.portraitRight),null!=this.getChildByName("buttons")&&this.removeChild(this.getChildByName("buttons"))},e.prototype.buttonJiaoDiZhu=function(t){console.log("叫地主"),null!=this.getChildByName("puker")&&this.removeChild(this.getChildByName("puker")),this.puker=new PukerContainer(this,this.pukers1.concat(this.pukers4).sort(PukerUtils.sortDESC)),this.puker.name="puker",this.addChild(this.puker),null!=this.getChildByName("buttons")&&this.removeChild(this.getChildByName("buttons")),this.buttons=new PlayerButtonContainer(this,2),this.buttons.name="buttons",this.addChild(this.buttons)},e.prototype.buttonBuQiang=function(t){console.log("不抢")},e.prototype.buttonQiangDiZhu=function(t){console.log("抢地主")},e.prototype.buttonBuYao=function(t){console.log("不要")},e.prototype.buttonTiShi=function(t){console.log("提示")},e.prototype.pukerClick=function(t){var e=RES.getRes("layout_json").puker,r=e.pukerUpMove,i=t.currentTarget;i.y==r?(i.y=0,this.pukerSelectArray.push(parseInt(i.name))):(i.y=r,this.pukerSelectArray=PukerUtils.removeElements(this.pukerSelectArray,[parseInt(i.name)]))},e.prototype.timerFunc=function(){switch(this.index){case 0:this.puker=new PukerContainer(this,[54,53,2,15,28,41,1,14,27,13,26,39,11,24,10,9,8,7,6,5]),this.puker.name="puker",this.addChild(this.puker);break;case 1:this.puker.removePukerByNames([9,8,7,6,5]),this.pukerPlay=new PukerPlayContainer([9,8,7,6,5]),this.pukerPlay.name="pukerPlay",this.addChild(this.pukerPlay);break;case 2:this.pukerRight=new PukerOtherContainer([23,22,21,20,19],!1),this.pukerRight.name="pukerRight",this.addChild(this.pukerRight);break;case 3:this.textLeft=new TextOtherContainer("不要",!0),this.textLeft.name="textLeft",this.addChild(this.textLeft);break;case 4:this.puker.removePukerByNames([54,53]),this.removeChild(this.getChildByName("pukerPlay")),this.pukerPlay=new PukerPlayContainer([54,53]),this.pukerPlay.name="pukerPlay",this.addChild(this.pukerPlay);break;case 5:this.removeChild(this.getChildByName("pukerRight")),this.textRight=new TextOtherContainer("要不起",!1),this.textRight.name="textRight",this.addChild(this.textRight)}console.log("计时",this.index),this.index++},e.prototype.timerComFunc=function(){console.log("计时结束")},e}(egret.DisplayObjectContainer);__reflect(PlayerP2C.prototype,"PlayerP2C");var PlayerP2P_Single=function(t){function e(e,r){var i=t.call(this)||this;i.key="room",i.pukerSelectArray=new Array,i.index=0,i.pukerUtil=new PukerUtils,i.pukers=[],i.pukers1=[],i.pukers2=[],i.pukers3=[],i.pukers4=[],i.layout=RES.getRes("layout_json").layout,i.mySeat=e;var n=new Layout(i.layout.stageWidth,i.layout.stageHeight);if(i.addChild(n),i.show(),console.log("进入游戏房间，座位号:",i.mySeat,"其他人:",r),null!=r&&r.length>0)for(var o=0;o<r.length;o++)i.loadOtherPlayerPortrait(r[o].seat,r[o].name,!1);return i}return __extends(e,t),e.prototype.receive=function(t,e){if(console.log("收到服务器数据--code:",t,"data",e),"11002"===t){console.log("Server发牌");var r=e.pukers;this.pukers1=r.sort(PukerUtils.sortDESC),this.puker=new PukerContainer(this,this.pukers1),this.puker.name="puker",this.addChild(this.puker),Socket.send({key:"room",code:"11001"})}else"11003"===t?(console.log("Server已随机选择地主"),e.self&&(null!=this.getChildByName("buttons")&&this.removeChild(this.getChildByName("buttons")),this.buttons=new PlayerButtonContainer(this,0),this.buttons.name="buttons",this.addChild(this.buttons))):"11004"===t?(console.log("争地主"),e.self&&(null!=this.getChildByName("buttons")&&this.removeChild(this.getChildByName("buttons")),this.buttons=new PlayerButtonContainer(this,1),this.buttons.name="buttons",this.addChild(this.buttons))):"11005"===t?(console.log("地主已确定"),e.self?(this.pukers1=this.pukers1.concat(e.pukers).sort(PukerUtils.sortDESC),null!=this.getChildByName("puker")&&this.removeChild(this.getChildByName("puker")),this.puker=new PukerContainer(this,this.pukers1),this.puker.name="puker",this.addChild(this.puker)):this.loadOtherPlayerPortrait(e.seat,null,!0),this.pukerBottom=new PukerBottomContainer(this.pukers4),this.pukerBottom.name="pukerBottom",this.addChild(this.pukerBottom)):"11006"===t?(console.log("有玩家进入房间"),this.loadOtherPlayerPortrait(e.seat,e.name,!1)):"11007"===t&&console.log("有玩家准备/取消准备")},e.prototype.loadOtherPlayerPortrait=function(t,e,r){this.isLeft(t)?(null!=this.getChildByName("portraitLeft")&&this.removeChild(this.getChildByName("portraitLeft")),null!=e&&(this.leftName=e),this.portraitLeft=new PortraitOtherContainer(this.leftName,1,!0,r),this.portraitLeft.name="portraitLeft",this.addChild(this.portraitLeft)):(null!=this.getChildByName("portraitRight")&&this.removeChild(this.getChildByName("portraitRight")),null!=e&&(this.leftName=e),this.portraitRight=new PortraitOtherContainer(this.leftName,2,!1,r),this.portraitRight.name="portraitRight",this.addChild(this.portraitRight))},e.prototype.isLeft=function(t){return 1==this.mySeat&&3==t?!0:2==this.mySeat&&1==t?!0:3==this.mySeat&&2==t?!0:!1},e.prototype.show=function(){Socket.register(this),Socket.send({key:"room",code:"11000"}),console.log("正在请求服务器... ..."),this.portraitLeft=new PortraitOtherContainer("等待玩家连接",1,!0,!1),this.portraitLeft.name="portraitLeft",this.addChild(this.portraitLeft),this.portraitRight=new PortraitOtherContainer("等待玩家连接",2,!1,!1),this.portraitRight.name="portraitRight",this.addChild(this.portraitRight);var t=new DefaultPortrait(1,360,700,100,100);t.name="portrait",this.addChild(t)},e.prototype.buttonChuPai=function(t){console.log("出牌"),Socket.send({key:"room",code:"11003",data:{"do":!0,data:this.pukerSelectArray}})},e.prototype.buttonBuJiao=function(t){console.log("不叫"),Socket.send({key:"room",code:"11002",data:{"do":!1}})},e.prototype.buttonJiaoDiZhu=function(t){console.log("叫地主"),Socket.send({key:"room",code:"11002",data:{"do":!0}})},e.prototype.buttonBuQiang=function(t){console.log("不抢"),Socket.send({key:"room",code:"11002",data:{"do":!1}})},e.prototype.buttonQiangDiZhu=function(t){console.log("抢地主"),Socket.send({key:"room",code:"11002",data:{"do":!0}})},e.prototype.buttonBuYao=function(t){console.log("不要"),Socket.send({key:"room",code:"11003",data:{"do":!1}})},e.prototype.buttonTiShi=function(t){console.log("提示")},e.prototype.pukerClick=function(t){var e=RES.getRes("layout_json").puker,r=e.pukerUpMove,i=t.currentTarget;i.y==r?(i.y=0,this.pukerSelectArray.push(parseInt(i.name))):(i.y=r,this.pukerSelectArray=PukerUtils.removeElements(this.pukerSelectArray,[parseInt(i.name)]))},e}(egret.DisplayObjectContainer);__reflect(PlayerP2P_Single.prototype,"PlayerP2P_Single",["SocketReceive"]);var PlayerP2P=function(){function t(){}return t}();__reflect(PlayerP2P.prototype,"PlayerP2P");var Boy=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.order=function(){var t=new DateEvent(DateEvent.DATE);t._year=2014,t._month=8,t._date=2,t._where="肯德基",t._todo="共进晚餐",this.dispatchEvent(t)},e}(egret.Sprite);__reflect(Boy.prototype,"Boy");var DateEvent=function(t){function e(e,r,i){void 0===r&&(r=!1),void 0===i&&(i=!1);var n=t.call(this,e,r,i)||this;return n._year=0,n._month=0,n._date=0,n._where="",n._todo="",n}return __extends(e,t),e}(egret.Event);DateEvent.DATE="约会",__reflect(DateEvent.prototype,"DateEvent");var Girl=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.getDate=function(t){console.log("得到了"+t.target.name+"的邀请！"),console.log("会在"+t._year+"年"+t._month+"月"+t._date+"日，在"+t._where+t._todo)},e}(egret.Sprite);__reflect(Girl.prototype,"Girl");var SampleDate=function(t){function e(){var e=t.call(this)||this,r=new Boy;r.name="男朋友";var i=new Girl;return i.name="女朋友",r.addEventListener(DateEvent.DATE,i.getDate,i),r.order(),r.removeEventListener(DateEvent.DATE,i.getDate,i),e}return __extends(e,t),e}(egret.DisplayObjectContainer);__reflect(SampleDate.prototype,"SampleDate");var T_globalToLocal=function(t){function e(){function e(){var t=i.globalToLocal(0,0);n.x=t.x,n.y=t.y}var r=t.call(this)||this,i=new egret.DisplayObjectContainer;i.x=200,i.y=200,r.addChild(i);var n=new egret.Shape;return n.graphics.beginFill(16711680),n.graphics.drawCircle(25,25,25),n.graphics.endFill(),i.addChild(n),n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,e,r),r}return __extends(e,t),e}(egret.DisplayObjectContainer);__reflect(T_globalToLocal.prototype,"T_globalToLocal");var T_touchMove=function(t){function e(){function e(t){n=t.currentTarget,o=t.stageX-n.x,a=t.stageY-n.y,this.addChild(n),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,i,this)}function r(t){console.log(22),this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,i,this)}function i(t){n.x=t.stageX-o,n.y=t.stageY-a}var n,o,a,s=t.call(this)||this,h=new egret.Shape;h.graphics.beginFill(16711680),h.graphics.drawCircle(25,25,25),h.graphics.endFill(),s.addChild(h);var l=new egret.Shape;return l.graphics.beginFill(255),l.graphics.drawRect(0,0,100,100),l.graphics.endFill(),s.addChild(l),h.touchEnabled=!0,h.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e,s),h.addEventListener(egret.TouchEvent.TOUCH_END,r,s),l.touchEnabled=!0,l.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e,s),l.addEventListener(egret.TouchEvent.TOUCH_END,r,s),s}return __extends(e,t),e}(egret.DisplayObjectContainer);__reflect(T_touchMove.prototype,"T_touchMove");var PukerUtils=function(){function t(){this.pukerValues=[1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,10,10,10,10,11,11,11,11,12,12,12,12,13,13,13,13,14,14],this.pukerOrderValues=["D","D","D","D","C","C","C","C","O","O","O","O","N","N","N","N","M","M","M","M","L","L","L","L","K","K","K","K","J","J","J","J","I","I","I","I","H","H","H","H","G","G","G","G","F","F","F","F","E","E","E","E","B","A"],this.pukerIds=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54]}return t.isBoom=function(t){return 4==t.length&&t[1]===t[0]&&t[2]===t[0]&&t[3]===t[0]?!0:!1},t.isKingBoom=function(t){return 2==t.length&&"A"===t[0]&&"B"===t[1]?!0:!1},t.isSingle=function(t){return 1==t.length?!0:!1},t.isPair=function(t){return 2==t.length&&t[0]===t[1]?!0:!1},t.isStraight=function(e){if(e.length<5||e.length>12)return!1;if(t.orderString.indexOf(e[0])<3)return!1;for(var r=0;r<e.length-1;r++)if(t.orderString.indexOf(e[r])+1!=t.orderString.indexOf(e[r+1]))return!1;return!0},t.isThree=function(t){if(3!=t.length&&4!=t.length)return!1;if(3==t.length){if(t[1]===t[0]&&t[2]===t[0])return!0}else if(t[1]===t[0]&&t[2]===t[0]&&t[3]!=t[0]||t[1]===t[3]&&t[2]===t[3]&&t[0]!=t[3])return!0;return!1},t.caseOne=function(e,r){var i=t.orderString;return i.indexOf(e)>-1&&i.indexOf(r)>-1&&i.indexOf(e)<i.indexOf(r)?!0:!1},t["case"]=function(e,r){return e.length<1||r.length<1?!1:t.isKingBoom(r)?!1:t.isKingBoom(e)?!0:t.isBoom(r)?t.isBoom(e)?t.caseOne(e[0],r[0]):!1:t.isBoom(e)?!0:e.length!=r.length?!1:1==e.length?t.caseOne(e[0],r[0]):2==e.length?t.isPair(e)&&t.isPair(r)?t.caseOne(e[0],r[0]):!1:void 0},t.prototype.init=function(){for(var e,r,i=this.pukerIds.length,n=this.pukerIds.slice(),o=[],a=0;a<this.pukerIds.length;a++)e=Math.floor(Math.random()*n.length),r=n[e],o.push(r),n=t.slice(n,0,e).concat(t.slice(n,e+1,n.length)),i--;return console.log(o.toString()),o},t.slice=function(t,e,r){return 0>e||0>r||e>t.length||r>t.length?[]:t.slice(e,r)},t.sortASC=function(t,e){return t>e?1:e>t?-1:0},t.sortDESC=function(t,e){return t>e?-1:e>t?1:0},t.removeElements=function(t,e){for(var r=0;r<e.length;r++)for(var i=0;i<t.length;i++)e[r]==t[i]&&(t=this.slice(t,0,i).concat(this.slice(t,i+1,t.length)));return t},t.findStraight=function(){var t=/5+6+7+8+9+/,e="34456667889";console.log("test:",t.test(e)?t.exec(e):"没有匹配项")},t.findThree=function(){var t=/7{3,}/,e="34577789";console.log("test:",t.test(e)?t.exec(e):"没有匹配项")},t.findPair=function(){var t=/7{2,}/,e="34577789";console.log("test:",t.test(e)?t.exec(e):"没有匹配项")},t}();PukerUtils.orderString="ABCDEFGHIJKLMNO",__reflect(PukerUtils.prototype,"PukerUtils");var GetConnection=function(){function t(){this.key="hall"}return t.prototype.receive=function(t,e){},t}();__reflect(GetConnection.prototype,"GetConnection",["SocketReceive"]);